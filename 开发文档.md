这是一份完整的 **CBA 赛场洞察 (CBA Live Insight)** Chrome 插件开发文档。

这份文档整合了产品需求（PRD）与技术实现方案，可以直接交付给开发人员（或作为你自己开发的蓝图）。

# ---

**🏀 CBA Live Insight \- Chrome 插件开发文档**

## **1\. 项目概述**

产品名称：CBA Live Insight (CBA 赛场洞察)  
适用平台：Google Chrome (PC版)  
运行环境：仅在 https://live.douyin.com/\* 域名下激活。  
核心功能：在抖音网页版观看CBA直播时，提供一个悬浮的数据面板。用户可通过下拉框选择当日比赛，插件将实时轮询接口，展示比分、球队对比数据及球员技术统计，解决直播流数据延迟及信息展示不全的问题。

## ---

**2\. 技术架构与选型**

* **核心规范**：Manifest V3  
* **前端框架**：React 18 (推荐) 或 Vue 3  
* **UI 框架**：Tailwind CSS (用于实现磨砂玻璃、现代深色模式 UI)  
* **构建工具**：Vite (配合 @crxjs/vite-plugin 支持热更新)  
* **数据流**：React Query 或 SWR (用于管理轮询和缓存)  
* **图标库**：Lucide React / Heroicons

## ---

**3\. 数据接口逻辑 (核心)**

本项目不需要自建后端，利用 Chrome Extension 的 host\_permissions 能力直接在前端跨域请求咪咕接口。

### **3.1 接口 A：获取当日比赛列表 (用于下拉框)**

* **请求方式**：GET  
* **URL**：  
  Plaintext  
  https://vms-sc.miguvideo.com/vms-match/v6/staticcache/basic/match-list/normal-match-list/0/2221401/default/1/miguvideo

* **请求频率**：插件初始化加载时请求 1 次，用户手动点击“刷新”时请求。  
* **数据解析流程**：  
  1. **获取服务器时间**：读取 timeStamp (如 "1766160489632")，将时间戳转为东八区时间，**定位当日日期数据**：访问 body.matchList\[todayKey\] 获取比赛数组。  
  2. **数据映射 (Mapping)**：  
     * **Value (ID)**: match.mgdbId (例如 "120000562119") —— **这是后续接口的关键参数**。  
     * **Label (显示)**: 组合 keyword (时间) \+ pkInfoTitle (对阵)。  
     * **Status**: matchStatus ("2"=进行中/完赛, "0"=未开始)。  
     * **Teams**: 遍历 confrontTeams 数组，通过 isHome ("1"为主队, "0"为客队) 区分主客队信息（Logo、名称）。

### **3.2 接口 B：获取实时统计数据 (用于面板展示)**

* **请求方式**：GET  
* **URL**：  
  Plaintext  
  https://v0-sc.miguvideo.com/vms-livedata/live-stream/v1/tech-statistic/{直播间ID}

  * *{直播间ID}* 替换为接口 A 中获取的 mgdbId。  
* **请求频率**：用户选中比赛后，每 **10秒** 轮询一次。  
* **数据解析流程**：  
  * **根节点**：body.statisticInfoList (数组，包含主客两队数据)。  
  * **球队核心数据 (teamStatisticList)**：  
    * 提取 dataKey 为 fieldGoalsPercentage (投篮), threePointPercentage (三分), freeThrowsPercentage (罚球), rebounds (篮板), assists (助攻), turnovers (失误)。  
  * **球员数据 (playerStatisticList)**：  
    * 合并 playerInfo (姓名/号码) 与 playDataList (各项数据)。  
    * 重点展示：points (得分), rebounds (篮板), assists (助攻), plusMinus (+/-值)。  
    * **高亮逻辑**：若 onCourt 值为 "1"，在 UI 上高亮该行。

## ---

**4\. UI/UX 界面设计**

界面风格采用 **Modern Dark Glassmorphism (现代深色磨砂)**，以黑色半透明为基底，CBA 官方橙红色 (\#FF6600) 为强调色。

### **4.1 布局结构**

界面分为两个状态：**收起态 (Capsule)** 和 **展开态 (Panel)**。

#### **A. 收起态 (Capsule)**

* **外观**：一个悬浮在屏幕右侧的圆形或胶囊形按钮。  
* **内容**：CBA Logo 或 "Data" 字样。  
* **交互**：点击展开面板。

#### **B. 展开态 (Panel) \- 宽度约 360px**

**1\. 顶部控制栏 (Header)**

* **下拉选择器**：默认显示 "请选择比赛"，点击下拉渲染接口 A 的数据。  
* **操作区**：关闭按钮 (×)、刷新按钮 (↻)。

**2\. 记分牌 (Scoreboard)**

* **布局**：\[客队Logo\] \[比分\] : \[比分\] \[主队Logo\]  
* **动效**：比分数字变化时，增加绿色/红色跳动效果。  
* **副信息**：显示比赛节数或剩余时间（如接口有提供，否则仅显示 Live）。

**3\. 数据切换 Tab**

* **Tab 1: 球队对比 (Team Stats)**  
  * 使用 **双向进度条**。左侧客队数据，右侧主队数据，中间显示数据名称（如 "FG%"）。  
  * *示例*： \[45%\] \<---- 投篮命中 \----\> \[52%\]  
* **Tab 2: 球员统计 (Player Box)**  
  * 内嵌子 Tab: \[客队\] | \[主队\]  
  * **表格列**：  
    * Player (头像+号码+名字)  
    * PTS (得分)  
    * \+/- (正负值)  
    * Stat (根据表现动态显示，如 "10板" 或 "8助")  
  * **在场状态**：在场球员名字前加绿色小圆点 ●。

## ---

**5\. 开发实现细节**

### **5.1 目录结构**

Plaintext

/src  
  /assets         \# 静态资源  
  /components     \# React 组件  
    FloatingBtn.jsx  
    MatchSelect.jsx  
    ScoreBoard.jsx  
    StatsPanel.jsx  
  /hooks          \# 自定义 Hooks  
    useMatchList.js  
    useLiveStats.js  
  /content        \# 注入页面的脚本  
    index.jsx     \# 入口文件  
  /background     \# 后台脚本  
  manifest.json  
  vite.config.js

### **5.2 Manifest.json 配置 (关键)**

必须配置 host\_permissions 以绕过跨域限制。

JSON

{  
  "manifest\_version": 3,  
  "name": "CBA Live Insight",  
  "version": "1.0.0",  
  "description": "CBA Real-time stats assistant for Douyin Live",  
  "permissions": \["storage"\],  
  "host\_permissions": \[  
    "https://live.douyin.com/\*",  
    "https://vms-sc.miguvideo.com/\*",  
    "https://v0-sc.miguvideo.com/\*"  
  \],  
  "action": {  
    "default\_icon": "assets/icon.png"  
  },  
  "content\_scripts": \[  
    {  
      "matches": \["https://live.douyin.com/\*"\],  
      "js": \["src/content/index.jsx"\],  
      "css": \["src/content/style.css"\],  
      "run\_at": "document\_idle"  
    }  
  \],  
  "web\_accessible\_resources": \[  
    {  
      "resources": \["assets/\*"\],  
      "matches": \["https://live.douyin.com/\*"\]  
    }  
  \]  
}

### **5.3 核心 Hook 代码逻辑示例**

**useMatchList.js (获取比赛列表)**

JavaScript

import { useState, useEffect } from 'react';

export function useMatchList() {  
  const \[matches, setMatches\] \= useState(\[\]);  
  const \[loading, setLoading\] \= useState(true);

  const fetchMatches \= async () \=\> {  
    setLoading(true);  
    try {  
      const res \= await fetch('https://vms-sc.miguvideo.com/vms-match/v6/staticcache/basic/match-list/normal-match-list/0/2221401/default/1/miguvideo');  
      const data \= await res.json();  
        
      // 1\. 获取服务器日期 Key  
      const sysDateStr \= data.body.sysdate.toString();  
      const todayKey \= sysDateStr.substring(0, 8); // e.g., "20251220"

      // 2\. 提取当日比赛  
      const dailyMatches \= data.body.matchList\[todayKey\] || \[\];  
        
      // 3\. 格式化数据  
      const formatted \= dailyMatches.map(m \=\> ({  
        id: m.mgdbId, // 关键 ID  
        title: m.pkInfoTitle,  
        time: m.keyword, // e.g., "12月20日19:35"  
        status: m.matchStatus,  
        homeTeam: m.confrontTeams.find(t \=\> t.isHome \=== '1'),  
        awayTeam: m.confrontTeams.find(t \=\> t.isHome \=== '0')  
      }));  
        
      setMatches(formatted);  
    } catch (err) {  
      console.error("Failed to fetch matches", err);  
    } finally {  
      setLoading(false);  
    }  
  };

  useEffect(() \=\> {  
    fetchMatches();  
  }, \[\]);

  return { matches, loading, refetch: fetchMatches };  
}

**useLiveStats.js (轮询统计数据)**

JavaScript

import { useState, useEffect, useRef } from 'react';

export function useLiveStats(matchId) {  
  const \[stats, setStats\] \= useState(null);  
  const timerRef \= useRef(null);

  useEffect(() \=\> {  
    if (\!matchId) return;

    const fetchStats \= async () \=\> {  
      try {  
        const res \= await fetch(\`https://v0-sc.miguvideo.com/vms-livedata/live-stream/v1/tech-statistic/${matchId}\`);  
        const data \= await res.json();  
        if (data.code \=== 200) {  
          setStats(data.body); // 这里可以加一层数据清洗逻辑  
        }  
      } catch (err) {  
        console.error("Stats polling error", err);  
      }  
    };

    // 立即执行一次  
    fetchStats();

    // 开启轮询 (10s)  
    timerRef.current \= setInterval(fetchStats, 10000);

    return () \=\> clearInterval(timerRef.current);  
  }, \[matchId\]);

  return stats;  
}

## ---

**6\. 构建与部署**

1. **初始化项目**：  
   Bash  
   npm create vite@latest cba-live-assistant \-- \--template react  
   cd cba-live-assistant  
   npm install  
   npm install \-D tailwindcss postcss autoprefixer @crxjs/vite-plugin  
   npx tailwindcss init \-p

2. 配置构建：  
   修改 vite.config.js 引入 CRXJS 插件，并指向 manifest.json。  
3. 本地开发：  
   运行 npm run dev。  
4. **加载插件**：  
   * 打开 Chrome 浏览器 \-\> 扩展程序 (chrome://extensions/)。  
   * 开启右上角 "开发者模式"。  
   * 点击 "加载已解压的扩展程序"，选择项目中的 dist 目录。  
5. 测试：  
   打开 https://live.douyin.com/，确认悬浮窗出现，数据加载正常。

## ---

**7\. 注意事项**

1. **防抖与异常**：网络波动可能导致 fetch 失败，需在 UI 上做容错处理（保留上一次成功的数据，而不是清空）。  
2. **数据为空处理**：比赛未开始时，统计接口可能返回空或 404，UI 需展示 "比赛未开始" 占位图。  
3. **样式隔离**：为了不污染抖音原网页样式，建议在 React 根节点使用 Shadow DOM，或者使用 Tailwind 的 prefix 功能（例如 cba- 前缀）。